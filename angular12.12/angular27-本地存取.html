<!DOCTYPE html>
<html ng-app="ydApp">
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<script src="js/angular.min.js"></script>
		<script src="js/angular-route.js"></script>
	</head>
	<body ng-controller="ydCtrl">
		<div class="container">
			<h1>评论</h1>
			<div class="col-md-6 clearfix">
				<div><textarea name="" rows="" cols="" class="form-control" ng-model="msg"></textarea></div>
				<input type="button" value="评论" ng-click="sendMsg()" class="btn btn-danger">
			</div>
			<div class="commet-item col-md-12" ng-repeat="item in comments track by $index">
				<div class="col-md-3">{{item.name}}</div>
				<div class="col-md-9">{{item.msg}}</div>
			</div>
			</div>
		
		<script>
			angular.module("ydApp",[])
			.controller("ydCtrl",["$scope","$http","$templateCache",function($scope,$http,$templateCache){
				$scope.comments=$fetchData("yd-comment");
				$scope.sendMsg=function(){
					$http({
						url:"server/comment.php",
						method:'POST',
						headers: {'Content-Type': 'application/x-www-form-urlencoded'},
						data:"name=mumu&msg="+$scope.msg
						
					})
					.success(function(res){
						$scope.comments=res.data.concat($scope.comments);
						$scope.msg="";
						$saveData("yd-comment",$scope.comments);
					})
					
				}
				// localStorage 本地存取 没有大写限制 不会被发送到服务器
				// 没有事件限制  用户手动清除才会清除
				// localStorage.setItem(name,data) 保存数据
				// localStorage.getItem(name) 获取数据
				// localStorage["name"] 获取数据
				// localStorage["name"]=data 设置数据
				// localStorage.name=data 设置数据
				// localStorage.name 获取数据
				// localStorage.removeItem(name) //清除 为name的数据
				// localStorage.clear() 清楚该域名下面的所有数据
				function $saveData(name,data){
				// JSON.stringify()把对象转换为 字符串 因为 本地存取只接收字符串
					window.localStorage[name]=JSON.stringify(data);
					
				}
				// fech 拿取
				function $fetchData(name){
				// JSON.parse 把字符串转换为对象
					return JSON.parse(window.localStorage.getItem(name)||"[]");
				}
				
			}])
			
		</script>
	</body>
</html>
